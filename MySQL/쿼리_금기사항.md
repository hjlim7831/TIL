
### **1. SARG(Search ARGument, 검색인수)란?**

<br>

**정의**
- 조건자(Predicate)에서 검색 대상 및 범위를 제한할 수 있는 식
- 해당 열에 인덱스 사용 및 쿼리 최적화를 위한 필요 조건

<br>

**Non-SARG(비 검색 인수)**
- 검색을 제한하지 않는 식
- 인덱스 사용이나 쿼리 최적화에 방해하는 요소

<br>

### **2. Index 사용 방해 요소 Non-SARG**

<br>

**Non-SARG 유형 + a**
- 불필요한 데이터(열, 행) 요청
- 부정형 사용 주의
- 불필요한 열 값 변형
- 부적절한 LIKE 식
- 열 간 비교

<br>

##### 1) 불필요한 열 참조

- SELECT 절에는 필요한 데이터만 넣고 * 를 사용해 불필요한 컬럼을 조회하지 않도록 한다. (오버헤드로 인한 성능 제한)
```
-- 1)
SELECT CategoryID, CategoryName FROM dbo.Categories
-- vs.
SELECT * FROM Categories

-- 2)
SELECT OrderID From dbo.Orders
-- vs.
SELECT OrderID, OrderDate FROM dbo.Orders
```

<br>

##### 2) 불필요한 행 검색(사례)

- 추가 검색 조건이나 적절한 TOP(Paging) 처리 필요
```
-- 결과가 500, 000건 발생한다고 했을 때
SELECT * FROM 웹사이트_오류_로그
WHERE 작성일자 BETWEEN '20220522' AND '20220522 23:59:59' ORDER BY 작성일자 DESC
```

##### 3) Index열에 부정형(>, <, IN, NOT IN, LIKE) 사용주의

- 조건은 "="이 가장 빠르고 효율적
- (Index 조건에 따라) 옵티마이저가 부정형을 긍정형으로 자동 변환
    - 하지만 결과는 항상 범위 검색
    - 불필요한 부정형(범위 검색)은 지양
- 검색 범위(행 수)가 적다면 긍정 조건 & 가능하면 "=" 조건으로 구현
- 가능하면 NOT IN은 사용하지 마라

<br>

### **3. Non-SARG, 불필요한 Index 열 값 변형**

##### Index 열에 (사칙) 연산 적용
- 부등식에 따라 우변/좌변으로 변환
```
-- Before
SELECT *
FROM dbo.[Order Details]
WHERE OrderID + 10 = 10268
AND ProductID = 5

-- After
SELECT *
FROM dbo.[Order Details]
WHERE OrderID = (10268 - 10)
AND ProductID = 5
```



### 참고 자료
https://velog.io/@jincrates/쿼리-금기사항